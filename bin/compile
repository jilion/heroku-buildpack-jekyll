#!/usr/bin/env ruby

$:.unshift File.expand_path("../../lib", __FILE__)
require "jekyll_pack"

message() {
  echo "-----> $*"
}

# Install Jekyll into APP_ROOT/.gems
cat << EOF > ~/.gemrc
gemhome: $1/.gems
gempath:
- $1/.gems
EOF

message "Installing jekyll version 1.0.2"
/usr/local/bin/gem install jekyll -v 1.0.2 --no-rdoc --no-ri | indent

message "Installing RedCloth version 4.2.9"
/usr/local/bin/gem install RedCloth -v 4.2.9 --no-rdoc --no-ri | indent

# Run Jekyll
message "Setting environment variables"
export GEM_HOME=$1/.gems
export PATH=$1/.gems/bin:$PATH
export LC_ALL=en_US.UTF8
cd $1
message "Compiling Jekyll site"

publish_future_articles=""
if [ "$PUBLISH_FUTURE_ARTICLES" == "$url" ]; then
  message "Publish posts with a future date."
  publish_future_articles="--future"
fi

$1/.gems/bin/jekyll --no-auto --no-server --no-lsi --safe "$publish_future_articles" | indent
